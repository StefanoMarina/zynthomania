<html>
  <head>
    <link href="lnf.css" rel="stylesheet">
    <link href="bootstrap-grid.min.css" rel="stylesheet">
    <script src="jquery/dist/jquery.min.js"></script>
  </head>

  <body>
    <div class="container">
      <div class="row">
        <div class="col-xs-10">
          <header class="row">
            <button class="bar-1 btn" id="btnBanks"><a>Banks</a></button>
            <button class="bar-1 btn" id=""><a>FX</a></button>
            <button class="bar-1 btn" id=""><a>OSC</a></button>
            <button class="bar-1 btn" id=""><a>Presets</a></button>
          </header>
          
          <!--panels-->
          <div id="pnlBanks" class="row controlPanel hidden">
              <select id="selBanks" class="col-xs-5" size="10"></select>
              <select id="selPatches" class="col-xs-5 hidden" size="10"></select>
          </div>
          
        </div> <!--col-10 -->
        <aside class="col-xs-2"> <!--aside -->
        </aside>
      </div> <!-- main row -->
    </div> <!--container-->

    
    <script type="text/javascript">
      
      /* Bank button load */
      function onBanksButtonClick() {
          $.ajax({method:'get', dataType: 'json', url: window.location.href+"getBanks"})
          .done (function(data){ 
            console.log('hey, it worked!'); console.log(data)
            /*TODO: check result*/
            let banks = data;
            let entry = '';
            let selectObject = $('#selBanks');
            selectObject.empty();
            
            banks.forEach( (value, index, array) => {
               let option = "<option value=\""+value+"\">"+value+'</option>';
               console.log(option);
               selectObject.append(option);
             });
             
             $('.controlPanel').addClass('hidden');
             $('#pnlBanks').removeClass('hidden');
           })
          .fail(function(){console.log('...and failed.')});
      }
      
      function onBankSelection() {
        let selectedBank = $('#selBanks').val();
        console.log('selected ' + selectedBank);
                
          $.ajax({method:'get', dataType: 'json', 
                  url: window.location.href+"getPatches", 
                  data: {bank: selectedBank},
                  contentType: 'application/json; charset=utf-8'
            })
          .done (function(data){ 
            console.log('hey, it worked!'); console.log(data)
            /*TODO: check result*/
            let patches = data;
            let entry = '';
            let selectObject = $('#selPatches');
            selectObject.empty();
            
            patches.forEach( (value, index, array) => {
               selectObject.append("<option value=\""+value.path+"\">"+value.name+"</option>");
             });
             
             selectObject.removeClass('hidden');
             
           })
          .fail(function(){console.log('...and failed.')});
      }
      
      function onPatchSelection(patch) {
        $.ajax({method:'post', url: window.location.href+"setPatch",
                data: JSON.stringify({"patch":patch}), 
                contentType: 'application/json; charset=utf-8'})
                .done( function() {})
                .fail( function() {console.log('...and failed.')});
      }
      
      /* Init */
      $(document).ready(function() {
          $('.bar-1').on('click', function() {
            console.log('test');
            $('.bar-1').removeClass('btn-selected');
            $(this).addClass('btn-selected');
            
          });
          
          $('#btnBanks').on('click', function() { onBanksButtonClick(); });
          $('#selBanks').on('change', function() { onBankSelection(); });
          $('#selPatches').on('change', function() {
            onPatchSelection($('#selPatches').val());
          });
      });
    </script>
  </body>
</html>
